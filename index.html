<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kernel Lens - Interactive Kernel Execution Visualizer</title>
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --user-space: #f093fb;
            --kernel-space: #4facfe;
            --vfs: #43e97b;
            --fs: #fa709a;
            --block: #fee140;
            --device: #30cfd0;
            --bg: #0f0f23;
            --text: #cccccc;
            --text-bright: #ffffff;
            --border: #333344;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            text-align: center;
            padding: 40px 20px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 12px;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5em;
            color: white;
            margin-bottom: 10px;
            font-weight: 700;
        }

        header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.1em;
        }

        /* Input Control */
        .input-section {
            background: #1a1a2e;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .input-section label {
            font-weight: 600;
            color: var(--text-bright);
            font-size: 1.1em;
        }

        .syscall-input {
            flex: 1;
            min-width: 300px;
            display: flex;
            gap: 10px;
        }

        select, input[type="text"], input[type="number"] {
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text-bright);
            font-size: 1em;
            font-family: 'Courier New', monospace;
        }

        select {
            min-width: 200px;
        }

        input[type="text"] {
            flex: 1;
        }

        input[type="number"] {
            width: 120px;
        }

        button.execute-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 700;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        button.execute-btn:hover {
            transform: translateY(-2px);
        }

        /* Main Visualization Area */
        .viz-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0;
            position: relative;
        }

        /* Layer Styles */
        .layer {
            background: #1a1a2e;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .layer.active {
            border-color: currentColor;
            box-shadow: 0 0 20px currentColor;
        }

        .layer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .layer-title {
            font-size: 1.4em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .layer-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .layer-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .operations {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .operation {
            background: rgba(255,255,255,0.05);
            border-left: 3px solid currentColor;
            padding: 12px 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            position: relative;
            overflow: hidden;
        }

        .operation.active {
            background: rgba(255,255,255,0.1);
            animation: glow 1s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px currentColor; }
            50% { box-shadow: 0 0 15px currentColor; }
        }

        .operation-label {
            color: var(--text);
            font-size: 0.85em;
            margin-bottom: 4px;
        }

        .operation-value {
            color: var(--text-bright);
            font-weight: 600;
        }

        .metrics {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .metric {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--text-bright);
            font-family: 'Courier New', monospace;
        }

        .metric-label {
            font-size: 0.85em;
            color: var(--text);
            margin-top: 4px;
        }

        /* Flow Connectors */
        .flow-connector {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin: -10px 0;
        }

        .flow-line {
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, transparent, currentColor, transparent);
            position: relative;
            overflow: hidden;
        }

        .flow-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
            left: 50%;
            transform: translateX(-50%);
            animation: flow-down 1.5s linear infinite;
            opacity: 0;
            box-shadow: 0 0 10px currentColor;
        }

        @keyframes flow-down {
            0% { top: 0%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }

        .flow-connector.active .flow-particle {
            opacity: 1;
        }

        /* Data Packet Visualization */
        .data-packet {
            background: rgba(255,255,255,0.1);
            border: 2px dashed currentColor;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .packet-header {
            font-weight: 700;
            color: var(--text-bright);
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .packet-fields {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 8px 15px;
            font-size: 0.85em;
        }

        .packet-field-name {
            color: var(--text);
        }

        .packet-field-value {
            color: var(--text-bright);
            font-weight: 600;
        }

        /* Color coding for layers */
        .layer.user-space {
            color: var(--user-space);
        }

        .layer.syscall-interface {
            color: var(--kernel-space);
        }

        .layer.vfs {
            color: var(--vfs);
        }

        .layer.filesystem {
            color: var(--fs);
        }

        .layer.block {
            color: var(--block);
        }

        .layer.device {
            color: var(--device);
        }

        /* Info Panel */
        .info-panel {
            background: #1a1a2e;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .info-panel h3 {
            color: var(--text-bright);
            margin-bottom: 10px;
        }

        .info-panel p {
            line-height: 1.6;
        }

        /* Code Display */
        .code-snippet {
            background: #0d0d1e;
            border-radius: 6px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            margin-top: 10px;
            overflow-x: auto;
        }

        .code-snippet .keyword { color: #c678dd; }
        .code-snippet .function { color: #61afef; }
        .code-snippet .string { color: #98c379; }
        .code-snippet .comment { color: #5c6370; font-style: italic; }
        .code-snippet .type { color: #e5c07b; }

        /* Legend */
        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            background: #1a1a2e;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .layer-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .input-section {
                flex-direction: column;
                align-items: stretch;
            }

            .syscall-input {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç Kernel Lens</h1>
            <p>Interactive Kernel Execution Visualizer - Watch syscalls flow through the kernel in real-time</p>
        </header>

        <div class="info-panel">
            <h3>How to use:</h3>
            <p>Select a system call, configure its parameters, and click Execute. Watch as your request flows through every layer of the kernel stack - all visible simultaneously. Hover over operations for details.</p>
        </div>

        <div class="input-section">
            <label>System Call:</label>
            <div class="syscall-input">
                <select id="syscall-select">
                    <option value="read">read(fd, buf, count)</option>
                    <option value="write">write(fd, buf, count)</option>
                    <option value="open">open(pathname, flags)</option>
                    <option value="close">close(fd)</option>
                </select>
                <input type="number" id="fd-input" placeholder="fd" value="3">
                <input type="number" id="size-input" placeholder="size" value="4096">
            </div>
            <button class="execute-btn" onclick="executeSystemCall()">‚ö° Execute</button>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: var(--user-space);"></div>
                <span>User Space</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: var(--kernel-space);"></div>
                <span>Syscall Interface</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: var(--vfs);"></div>
                <span>VFS Layer</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: var(--fs);"></div>
                <span>Filesystem</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: var(--block);"></div>
                <span>Block Layer</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: var(--device);"></div>
                <span>Device Driver</span>
            </div>
        </div>

        <div class="viz-container">
            <!-- USER SPACE LAYER -->
            <div class="layer user-space" id="layer-user">
                <div class="layer-header">
                    <div class="layer-title">
                        <span>User Space</span>
                        <span class="layer-badge" style="background: var(--user-space); color: white;">Ring 3</span>
                    </div>
                    <span style="font-family: monospace; font-size: 0.9em;">PID: 1234</span>
                </div>
                <div class="layer-content">
                    <div class="operations">
                        <div class="operation">
                            <div class="operation-label">Application Code</div>
                            <div class="code-snippet">
<span class="type">char</span> buffer[<span class="string">4096</span>];
<span class="type">int</span> fd = <span class="function">open</span>(<span class="string">"/etc/passwd"</span>, O_RDONLY);
<span class="type">ssize_t</span> n = <span class="function">read</span>(fd, buffer, <span class="keyword">sizeof</span>(buffer));
                            </div>
                        </div>
                        <div class="data-packet">
                            <div class="packet-header">üì¶ Request Parameters</div>
                            <div class="packet-fields">
                                <span class="packet-field-name">fd:</span>
                                <span class="packet-field-value" id="param-fd">3</span>
                                <span class="packet-field-name">*buf:</span>
                                <span class="packet-field-value">0x7ffc1234abcd</span>
                                <span class="packet-field-name">count:</span>
                                <span class="packet-field-value" id="param-count">4096</span>
                            </div>
                        </div>
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">User</div>
                            <div class="metric-label">CPU Mode</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">0Œºs</div>
                            <div class="metric-label">Elapsed</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FLOW CONNECTOR -->
            <div class="flow-connector user-space" id="flow-1">
                <div class="flow-line">
                    <div class="flow-particle"></div>
                    <div class="flow-particle" style="animation-delay: 0.5s;"></div>
                </div>
            </div>

            <!-- SYSCALL INTERFACE LAYER -->
            <div class="layer syscall-interface" id="layer-syscall">
                <div class="layer-header">
                    <div class="layer-title">
                        <span>System Call Interface</span>
                        <span class="layer-badge" style="background: var(--kernel-space); color: white;">Ring 0</span>
                    </div>
                    <span style="font-family: monospace; font-size: 0.9em;">SYSCALL #0</span>
                </div>
                <div class="layer-content">
                    <div class="operations">
                        <div class="operation">
                            <div class="operation-label">Context Switch</div>
                            <div class="operation-value">User Mode ‚Üí Kernel Mode (SYSCALL instruction)</div>
                        </div>
                        <div class="operation">
                            <div class="operation-label">Register Mapping</div>
                            <div class="operation-value">rax=0 (SYS_read), rdi=fd, rsi=buf, rdx=count</div>
                        </div>
                        <div class="operation">
                            <div class="operation-label">Entry Point</div>
                            <div class="code-snippet">
<span class="function">SYSCALL_DEFINE3</span>(read, <span class="type">unsigned int</span>, fd,
    <span class="type">char __user *</span>, buf, <span class="type">size_t</span>, count) {
    <span class="keyword">return</span> <span class="function">ksys_read</span>(fd, buf, count);
}
                            </div>
                        </div>
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">Kernel</div>
                            <div class="metric-label">CPU Mode</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">~1Œºs</div>
                            <div class="metric-label">Context Switch</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FLOW CONNECTOR -->
            <div class="flow-connector syscall-interface" id="flow-2">
                <div class="flow-line">
                    <div class="flow-particle"></div>
                    <div class="flow-particle" style="animation-delay: 0.5s;"></div>
                </div>
            </div>

            <!-- VFS LAYER -->
            <div class="layer vfs" id="layer-vfs">
                <div class="layer-header">
                    <div class="layer-title">
                        <span>Virtual File System (VFS)</span>
                    </div>
                    <span style="font-family: monospace; font-size: 0.9em;">vfs_read()</span>
                </div>
                <div class="layer-content">
                    <div class="operations">
                        <div class="operation">
                            <div class="operation-label">FD ‚Üí File Mapping</div>
                            <div class="operation-value">fdget_pos(fd=3) ‚Üí struct file *f</div>
                        </div>
                        <div class="operation">
                            <div class="operation-label">File Structure</div>
                            <div class="operation-value">f_op = ext4_file_operations, f_inode = 0x2a5b91</div>
                        </div>
                        <div class="operation">
                            <div class="operation-label">Permission Check</div>
                            <div class="operation-value">file_permission(f, MAY_READ) ‚Üí OK</div>
                        </div>
                        <div class="data-packet">
                            <div class="packet-header">üìã File Descriptor Table</div>
                            <div class="packet-fields">
                                <span class="packet-field-name">fd 3:</span>
                                <span class="packet-field-value">/etc/passwd</span>
                                <span class="packet-field-name">inode:</span>
                                <span class="packet-field-value">524288</span>
                                <span class="packet-field-name">pos:</span>
                                <span class="packet-field-value">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">Hit</div>
                            <div class="metric-label">Dentry Cache</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">~0.5Œºs</div>
                            <div class="metric-label">Lookup Time</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FLOW CONNECTOR -->
            <div class="flow-connector vfs" id="flow-3">
                <div class="flow-line">
                    <div class="flow-particle"></div>
                    <div class="flow-particle" style="animation-delay: 0.5s;"></div>
                </div>
            </div>

            <!-- FILESYSTEM LAYER -->
            <div class="layer filesystem" id="layer-fs">
                <div class="layer-header">
                    <div class="layer-title">
                        <span>File System (ext4)</span>
                    </div>
                    <span style="font-family: monospace; font-size: 0.9em;">ext4_file_read_iter()</span>
                </div>
                <div class="layer-content">
                    <div class="operations">
                        <div class="operation">
                            <div class="operation-label">Inode Lookup</div>
                            <div class="operation-value">Load inode 524288, size=2.1KB, blocks=8</div>
                        </div>
                        <div class="operation">
                            <div class="operation-label">Block Mapping</div>
                            <div class="operation-value">Logical block 0 ‚Üí Physical block 12345678</div>
                        </div>
                        <div class="operation">
                            <div class="operation-label">Page Cache Check</div>
                            <div class="operation-value">find_get_page() ‚Üí Cache HIT (85% hit rate)</div>
                        </div>
                        <div class="data-packet">
                            <div class="packet-header">üóÑÔ∏è Extent Tree</div>
                            <div class="packet-fields">
                                <span class="packet-field-name">logical:</span>
                                <span class="packet-field-value">0-7</span>
                                <span class="packet-field-name">physical:</span>
                                <span class="packet-field-value">12345678-12345685</span>
                                <span class="packet-field-name">length:</span>
                                <span class="packet-field-value">8 blocks (32KB)</span>
                            </div>
                        </div>
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">4KB</div>
                            <div class="metric-label">Block Size</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">85%</div>
                            <div class="metric-label">Cache Hit</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FLOW CONNECTOR -->
            <div class="flow-connector filesystem" id="flow-4">
                <div class="flow-line">
                    <div class="flow-particle"></div>
                    <div class="flow-particle" style="animation-delay: 0.5s;"></div>
                </div>
            </div>

            <!-- BLOCK LAYER -->
            <div class="layer block" id="layer-block">
                <div class="layer-header">
                    <div class="layer-title">
                        <span>Block I/O Layer</span>
                    </div>
                    <span style="font-family: monospace; font-size: 0.9em;">submit_bio()</span>
                </div>
                <div class="layer-content">
                    <div class="operations">
                        <div class="operation">
                            <div class="operation-label">BIO Creation</div>
                            <div class="operation-value">bio_alloc(sector=98765424, size=4096)</div>
                        </div>
                        <div class="operation">
                            <div class="operation-label">I/O Scheduler</div>
                            <div class="operation-value">mq-deadline: merge/sort queue (depth=32)</div>
                        </div>
                        <div class="operation">
                            <div class="operation-label">Request Dispatch</div>
                            <div class="operation-value">blk_mq_run_hw_queue() ‚Üí SCSI layer</div>
                        </div>
                        <div class="data-packet">
                            <div class="packet-header">üíæ Block Request</div>
                            <div class="packet-fields">
                                <span class="packet-field-name">sector:</span>
                                <span class="packet-field-value">98765424</span>
                                <span class="packet-field-name">nr_sectors:</span>
                                <span class="packet-field-value">8</span>
                                <span class="packet-field-name">queue:</span>
                                <span class="packet-field-value">depth 12/32</span>
                            </div>
                        </div>
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">32</div>
                            <div class="metric-label">Queue Depth</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">~10Œºs</div>
                            <div class="metric-label">Queue Time</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FLOW CONNECTOR -->
            <div class="flow-connector block" id="flow-5">
                <div class="flow-line">
                    <div class="flow-particle"></div>
                    <div class="flow-particle" style="animation-delay: 0.5s;"></div>
                </div>
            </div>

            <!-- DEVICE LAYER -->
            <div class="layer device" id="layer-device">
                <div class="layer-header">
                    <div class="layer-title">
                        <span>Device Driver</span>
                    </div>
                    <span style="font-family: monospace; font-size: 0.9em;">/dev/sda</span>
                </div>
                <div class="layer-content">
                    <div class="operations">
                        <div class="operation">
                            <div class="operation-label">SCSI Command</div>
                            <div class="operation-value">READ_10: LBA=98765424, transfer_len=4096</div>
                        </div>
                        <div class="operation">
                            <div class="operation-label">DMA Transfer</div>
                            <div class="operation-value">Setup DMA: device ‚Üí memory (0x1234abcd0000)</div>
                        </div>
                        <div class="operation">
                            <div class="operation-label">IRQ Handler</div>
                            <div class="operation-value">scsi_done() ‚Üí IRQ 45 ‚Üí complete request</div>
                        </div>
                        <div class="data-packet">
                            <div class="packet-header">üîå Hardware I/O</div>
                            <div class="packet-fields">
                                <span class="packet-field-name">device:</span>
                                <span class="packet-field-value">SATA SSD</span>
                                <span class="packet-field-name">latency:</span>
                                <span class="packet-field-value">~150Œºs</span>
                                <span class="packet-field-name">status:</span>
                                <span class="packet-field-value">‚úì Success</span>
                            </div>
                        </div>
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">150Œºs</div>
                            <div class="metric-label">Device Latency</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">4096B</div>
                            <div class="metric-label">Transferred</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FLOW CONNECTOR (RETURN) -->
            <div class="flow-connector device" id="flow-6">
                <div class="flow-line">
                    <div class="flow-particle"></div>
                    <div class="flow-particle" style="animation-delay: 0.5s;"></div>
                </div>
            </div>

            <!-- RETURN TO USER -->
            <div class="layer user-space" id="layer-return">
                <div class="layer-header">
                    <div class="layer-title">
                        <span>Return to User Space</span>
                        <span class="layer-badge" style="background: var(--user-space); color: white;">Ring 3</span>
                    </div>
                    <span style="font-family: monospace; font-size: 0.9em;">syscall_exit</span>
                </div>
                <div class="layer-content">
                    <div class="operations">
                        <div class="operation">
                            <div class="operation-label">Data Copy</div>
                            <div class="operation-value">copy_to_user(buf, kernel_buf, 4096) ‚Üí userspace</div>
                        </div>
                        <div class="operation">
                            <div class="operation-label">Context Restore</div>
                            <div class="operation-value">Kernel Mode ‚Üí User Mode (SYSRET instruction)</div>
                        </div>
                        <div class="data-packet">
                            <div class="packet-header">‚úÖ Return Value</div>
                            <div class="packet-fields">
                                <span class="packet-field-name">bytes_read:</span>
                                <span class="packet-field-value" id="result-bytes">4096</span>
                                <span class="packet-field-name">total_time:</span>
                                <span class="packet-field-value">~175Œºs</span>
                                <span class="packet-field-name">status:</span>
                                <span class="packet-field-value">Success</span>
                            </div>
                        </div>
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">User</div>
                            <div class="metric-label">CPU Mode</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">175Œºs</div>
                            <div class="metric-label">Total Time</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let executionActive = false;
        let currentLayer = 0;

        const layers = [
            'layer-user',
            'layer-syscall',
            'layer-vfs',
            'layer-fs',
            'layer-block',
            'layer-device',
            'layer-return'
        ];

        const flows = [
            'flow-1',
            'flow-2',
            'flow-3',
            'flow-4',
            'flow-5',
            'flow-6'
        ];

        function executeSystemCall() {
            if (executionActive) return;

            executionActive = true;
            currentLayer = 0;

            // Update parameters from input
            const fd = document.getElementById('fd-input').value;
            const size = document.getElementById('size-input').value;
            document.getElementById('param-fd').textContent = fd;
            document.getElementById('param-count').textContent = size;
            document.getElementById('result-bytes').textContent = size;

            // Reset all layers
            layers.forEach(id => {
                document.getElementById(id).classList.remove('active');
            });
            flows.forEach(id => {
                document.getElementById(id).classList.remove('active');
            });

            // Start execution sequence
            executeLayer(0);
        }

        function executeLayer(index) {
            if (index >= layers.length) {
                executionActive = false;
                return;
            }

            // Activate current layer
            document.getElementById(layers[index]).classList.add('active');

            // Activate flow to next layer (if exists)
            if (index < flows.length) {
                setTimeout(() => {
                    document.getElementById(flows[index]).classList.add('active');
                }, 300);
            }

            // Deactivate previous layer after brief overlap
            if (index > 0) {
                setTimeout(() => {
                    document.getElementById(layers[index - 1]).classList.remove('active');
                    if (index > 1) {
                        document.getElementById(flows[index - 2]).classList.remove('active');
                    }
                }, 800);
            }

            // Move to next layer
            setTimeout(() => {
                executeLayer(index + 1);
            }, 1200);
        }

        // Auto-execute on load for demo
        window.addEventListener('load', () => {
            setTimeout(() => {
                executeSystemCall();
            }, 1000);
        });
    </script>
</body>
</html>
